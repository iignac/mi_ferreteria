@model IEnumerable<mi_ferreteria.Models.Categoria>
@{
    ViewData["Title"] = "Categor�as";
}
<h2 class="mb-3">Categor�as</h2>
<div class="text-center mb-4">
    <a asp-action="Create" class="btn btn-primary btn-lg btn-cta">Crear categor�a</a>
 </div>
@if (Model == null || !Model.Any())
{
    <div class="alert alert-info">No hay categor�as.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered align-middle table-products">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Padre</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var c in Model)
            {
                <tr class="clickable-row" data-href="@Url.Action("Edit","Categoria", new { id = c.Id })">
                    <td>@c.Id</td>
                    <td>@c.Nombre</td>
                    <td>@c.IdPadre</td>
                    <td class="text-end">
                        <a asp-action="Edit" asp-route-id="@c.Id" class="btn btn-sm btn-outline-primary">Editar</a>
                        <a asp-action="Delete" asp-route-id="@c.Id" class="btn btn-sm btn-outline-danger">Eliminar</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

@{
    int page = ViewBag.Page is int ? (int)ViewBag.Page : 1;
    int totalPages = ViewBag.TotalPages is int ? (int)ViewBag.TotalPages : 1;
}

@if (totalPages > 1)
{
    var start = System.Math.Max(1, page - 2);
    var end = System.Math.Min(totalPages, page + 2);
    <nav aria-label="Paginación de categorías" class="mt-3">
        <ul class="pagination justify-content-center">
            <li class="page-item @(page <= 1 ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(page - 1)">Anterior</a>
            </li>
            @for (var i = start; i <= end; i++)
            {
                <li class="page-item @(i == page ? "active" : "")">
                    <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                </li>
            }
            <li class="page-item @(page >= totalPages ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(page + 1)">Siguiente</a>
            </li>
        </ul>
    </nav>
}

@section Scripts {
<script>
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('table.table-products tbody tr.clickable-row').forEach(function(tr){
    tr.addEventListener('click', function(e){
      var t = e.target;
      if (t && t.closest && (t.closest('a') || t.closest('button'))) return;
      var href = this.getAttribute('data-href');
      if (href) window.location.href = href;
    });
  });
});
</script>
}
