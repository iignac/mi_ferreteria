@model IEnumerable<mi_ferreteria.Models.Producto>
@{
    ViewData["Title"] = "Productos";
}

<h2 class="mb-3">Productos</h2>
@{
    var stocks = ViewBag.Stocks as System.Collections.Generic.IDictionary<long, long>;
}
@if (ViewBag.LoadError == true)
{
    <div class="alert alert-danger">No pudimos cargar los productos. Por favor, intenta nuevamente m�s tarde.</div>
}

<div class="text-center mb-4">
    <a asp-action="Create" class="btn btn-primary btn-lg btn-cta">Crear producto</a>
 </div>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info">No hay productos cargados.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered align-middle table-products">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>SKU</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Ubicaci�n</th>
                    <th>Stock</th>
                    <th>Activo</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var p in Model)
            {
                <tr class="clickable-row" data-href="@Url.Action("Edit","Producto", new { id = p.Id })">
                    <td>@p.Id</td>
                    <td>@p.Sku</td>
                    <td>@p.Nombre</td>
                    <td>$ @p.PrecioVentaActual</td>
                    <td>@(string.IsNullOrWhiteSpace(p.UbicacionCodigo) ? "-" : p.UbicacionCodigo)</td>
                    <td>@(stocks != null && stocks.ContainsKey(p.Id) ? stocks[p.Id] : 0)</td>
                    <td>
                        @if (p.Activo) { <span class="badge bg-success">S�</span>; } else { <span class="badge bg-secondary">No</span>; }
                    </td>
                    <td class="text-end">
                        <a asp-action="Edit" asp-route-id="@p.Id" class="btn btn-sm btn-outline-primary">Editar</a>
                        <a asp-controller="StockProducto" asp-action="Manage" asp-route-id="@p.Id" class="btn btn-sm btn-outline-secondary">Stock</a>
                        <a asp-action="Delete" asp-route-id="@p.Id" class="btn btn-sm btn-outline-danger btn-delete-prod">Eliminar</a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

@section Scripts {
<script>
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.btn-delete-prod').forEach(function(a){
    a.addEventListener('click', function(e){
      if(!confirm('�Seguro que deseas eliminar este producto?')){
        e.preventDefault();
      }
    });
  });

  // Click en fila -> Editar (excepto botones/enlaces)
  document.querySelectorAll('table.table-products tbody tr.clickable-row').forEach(function(tr){
    tr.addEventListener('click', function(e){
      var t = e.target;
      if (t && t.closest && (t.closest('a') || t.closest('button'))) return;
      var href = this.getAttribute('data-href');
      if (href) window.location.href = href;
    });
  });
});
</script>
}


